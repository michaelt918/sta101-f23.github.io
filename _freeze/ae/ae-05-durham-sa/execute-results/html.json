{
  "hash": "85d81db2e12af616543a7b41049de904",
  "result": {
    "markdown": "---\ntitle: \"2020 Durham City and County Resident Survey\"\ncategories: \n  - Application exercise\n  - Suggested answers\neditor: visual\n---\n\n\n::: callout-important\nThese are suggested answers for the application exercise. They're not necessarily complete or 100% accurate, they're roughly what we develop in class while going through the exercises.\n:::\n\nThe main questions we'll explore today are:\n\n-   \"What are the demographics and priorities of City of Durham residents?\"\n\n-   \"How do City of Durham residents feel about quality of services by the city and how, if at all, does that vary by income?\"\n\n# Goals\n\n-   Wrapping up discussion on categorical data\n\n-   Visualizing and summarizing numerical data\n\n-   Improving visualizations for visual appeal and better communication\n\n# Packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n:::\n\n\n# Data\n\nThe data for this case study come from the 2020 Durham City and County Resident Survey.\n\nFirst, let's load the data:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndurham <- read_csv(\"data/durham-2020.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 803 Columns: 49\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (7): please_define_other_32_5, primary_language, please_define_other_34...\ndbl (42): id, overall_quality_of_services_3_01, overall_quality_of_services_...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n:::\n\n\nIn the last application exercise we manipulated the data a bit.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndurham <- durham |>\n  rename(\n    own_rent = do_you_own_or_rent_your_current_resi_31,\n    income = would_you_say_your_total_annual_hous_35,\n    # a few new ones\n    qos_city = overall_quality_of_services_3_01,\n    qos_county = overall_quality_of_services_3_02,\n    qol_durham = overall_quality_of_life_in_d_3_06,\n    qol_neighborhood = overall_quality_of_life_in_y_3_07\n  ) |>\n  mutate(\n    income = as_factor(income),\n    own_rent = as_factor(own_rent)\n  )\n```\n:::\n\n\n# Visualizing relationships between categorical variables\n\n## Exercise 1\n\nVisualize and describe the relationship between income and home ownership of Durham residents.\n\n*Stretch goal:* Customize the colors using named colors from <http://www.stat.columbia.edu/~tzheng/files/Rcolor.pdf>.\n\n*Add your answer here.*\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndurham |>\n  select(income, own_rent) |>\n  drop_na() |>\n  ggplot(aes(y = income, fill = own_rent)) +\n  geom_bar(position = \"fill\") +\n  scale_y_discrete(\n    labels = c(\n      \"1\" = \"Under $30,000\",\n      \"2\" = \"$30,000-$59,999\",\n      \"3\" = \"$60,000-$99,999\",\n      \"4\" = \"$100,000 or more\"\n    )\n  ) +\n  scale_fill_manual(\n    values = c(\"1\" = \"cadetblue\", \"2\" = \"coral\"),\n    labels = c(\"1\" = \"Own\", \"2\" = \"Rent\")\n  ) +\n  labs(\n    x = \"Proportion\",\n    y = \"Would you say your total\\nannual household income is...\",\n    fill = \"Do you own\\nor rent\\nyour current\\nresidence?\",\n    title = \"Income vs. home ownership of Durham residents\"\n  )\n```\n\n::: {.cell-output-display}\n![](ae-05-durham-sa_files/figure-html/income-own-rent-plot-1.png){width=960}\n:::\n:::\n\n\n## Exercise 2\n\nCalculate the proportions of home owners for each category of Durham residents. Describe the relationship between these two variables, this time with the actual values from the **conditional distribution** of home ownership based on income level.\n\n*Add your answer here.*\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndurham |>\n  select(income, own_rent) |>\n  drop_na() |>\n  count(income, own_rent) |>\n  group_by(income) |>\n  mutate(prop = n / sum(n))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 8 × 4\n# Groups:   income [4]\n  income own_rent     n   prop\n  <fct>  <fct>    <int>  <dbl>\n1 1      1           51 0.362 \n2 1      2           90 0.638 \n3 2      1          105 0.565 \n4 2      2           81 0.435 \n5 3      1          107 0.552 \n6 3      2           87 0.448 \n7 4      1          160 0.930 \n8 4      2           12 0.0698\n```\n\n\n:::\n:::\n\n\n## Exercise 3\n\nRecode the **level**s of these two variables to be more informatively labeled and calculate the proportions from the previous exercise again.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndurham <- durham |>\n  mutate(\n    income = case_when(\n      income == \"1\" ~ \"Under $30,000\",\n      income == \"2\" ~ \"$30,000-$59,999\",\n      income == \"3\" ~ \"$60,000-$99,999\",\n      income == \"4\" ~ \"$100,000 or more\"      \n    ),\n    income = fct_relevel(income, \"Under $30,000\", \"$30,000-$59,999\", \"$60,000-$99,999\", \"$100,000 or more\"),\n    own_rent = if_else(own_rent == 1, \"Own\", \"Rent\"),\n  )\n\ndurham |>\n  select(income, own_rent) |>\n  drop_na() |>\n  count(income, own_rent) |>\n  group_by(income) |>\n  mutate(prop = n / sum(n))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 8 × 4\n# Groups:   income [4]\n  income           own_rent     n   prop\n  <fct>            <chr>    <int>  <dbl>\n1 Under $30,000    Own         51 0.362 \n2 Under $30,000    Rent        90 0.638 \n3 $30,000-$59,999  Own        105 0.565 \n4 $30,000-$59,999  Rent        81 0.435 \n5 $60,000-$99,999  Own        107 0.552 \n6 $60,000-$99,999  Rent        87 0.448 \n7 $100,000 or more Own        160 0.930 \n8 $100,000 or more Rent        12 0.0698\n```\n\n\n:::\n:::\n\n\n# Visualizing numerical data\n\n## Exercise 4\n\nOne of the questions on the survey is \"How satisfied are you with the overall quality of services provided by the city?\" A response of 1 indicates Very Dissatisfied and a response of 5 indicates Very Satisfied. The responses for this question are in the variable `qos_city`. This could be considered an ordinal, categorical variable but can also be treated as a numerical variable in an analysis. Let's do the latter!\n\nVisualize and describe the distribution of `qos_city`. If you get a warning with your visualization, comment on what it means.\n\n*Add your response here.*\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(durham, aes(x = qos_city)) +\n  geom_histogram(binwidth = 1) +\n  labs(\n    x = \"Quality of services provided by the city\\n1 - Very Dissatisfied, 5 - Very Satisfied\"\n  )\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 75 rows containing non-finite values (`stat_bin()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](ae-05-durham-sa_files/figure-html/qos-city-hist-1.png){width=672}\n:::\n:::\n\n\n## Exercise 5\n\nCalculate the mean and median of the distribution of `qos_city`. If these values are not exactly the same, can you explain what the difference might be attributed to?\n\n*Add your response here.*\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndurham |>\n  summarize(\n    mean_qos_city = mean(qos_city, na.rm = TRUE),\n    median_mean_qos_city = median(qos_city, na.rm = TRUE)\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 2\n  mean_qos_city median_mean_qos_city\n          <dbl>                <dbl>\n1          3.54                    4\n```\n\n\n:::\n:::\n\n\n## Exercise 6\n\nBased on the shape of the distribution of `qos_city`, which measure of spread (variability) is more appropriate? Calculate that value and interpret it in context of the data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndurham |>\n  summarize(\n    iqr_qos_city = IQR(qos_city, na.rm = TRUE),\n    q1_qos_city = quantile(qos_city, 0.25, na.rm = TRUE),\n    q3_qos_city = quantile(qos_city, 0.75, na.rm = TRUE)\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 3\n  iqr_qos_city q1_qos_city q3_qos_city\n         <dbl>       <dbl>       <dbl>\n1            1           3           4\n```\n\n\n:::\n:::\n\n\n## Exercise 7\n\nMake a box plot of `qos_city` and comment on how the values you calculated map on to the box plot.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(durham, aes(x = qos_city)) +\n  geom_boxplot() +\n  labs(\n    x = \"Quality of services provided by the city\\n1 - Very Dissatisfied, 5 - Very Satisfied\"\n  )\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 75 rows containing non-finite values (`stat_boxplot()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](ae-05-durham-sa_files/figure-html/qos-city-box-1.png){width=672}\n:::\n:::\n\n\n## Exercise 8\n\nHow the average level of happiness with quality of services provided by the city vary by income group?\n\n*Stretch goal:* Visualize mean `qos_city` by income group.\n\n*Add your response here.*\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndurham |>\n  group_by(income) |>\n  summarize(\n    mean_qos_city = mean(qos_city, na.rm = TRUE)\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 2\n  income           mean_qos_city\n  <fct>                    <dbl>\n1 Under $30,000             3.45\n2 $30,000-$59,999           3.50\n3 $60,000-$99,999           3.56\n4 $100,000 or more          3.72\n5 <NA>                      3.37\n```\n\n\n:::\n\n```{.r .cell-code}\ndurham |>\n  group_by(income) |>\n  summarize(\n    mean_qos_city = mean(qos_city, na.rm = TRUE)\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 2\n  income           mean_qos_city\n  <fct>                    <dbl>\n1 Under $30,000             3.45\n2 $30,000-$59,999           3.50\n3 $60,000-$99,999           3.56\n4 $100,000 or more          3.72\n5 <NA>                      3.37\n```\n\n\n:::\n\n```{.r .cell-code}\ndurham |>\n  drop_na(income) |>\n  group_by(income) |>\n  summarize(\n    mean_qos_city = mean(qos_city, na.rm = TRUE)\n  ) |>\n  ggplot(aes(x = income, y = mean_qos_city)) +\n  geom_point() +\n  geom_line()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_line()`: Each group consists of only one observation.\nℹ Do you need to adjust the group aesthetic?\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](ae-05-durham-sa_files/figure-html/qos-city-income-mean-1.png){width=672}\n:::\n:::\n\n\n# Recap\n\n## Conceptual\n\nSome of the terms we introduced are:\n\n-   **Marginal distribution**: Distribution of a single variable.\n\n-   **Conditional distribution**: Distribution of a variable conditioned on the values (or levels, in the context of categorical data) of another.\n\n## R\n\nIn this application exercise we:\n\n-   Defined **factor**s -- the data type that R uses for categorical variables, i.e., variables that can take on values from a finite set of **level**s.\n-   Reviewed data imports, visualization, and wrangling functions encountered before:\n    -   Import: `read_csv()`: Read data from a CSV (comma separated values) file\n    -   Visualization:\n        -   `ggplot()`: Create a plot using the ggplot2 package\n        -   `aes()`: Map variables from the data to **aes**thetic elements of the plot, generally passed as an argument to `ggplot()` or to `geom_*()` functions (define only `x` **or** `y` aesthetic)\n        -   `geom_bar()`: Represent data with bars, after calculating heights of bars under the hood\n        -   `geom_histogram()`: Represent data with a histogram\n        -   `geom_boxplot()`: Represent data with a box plot\n        -   `geom_point()`: Represent data with points\n        -   `labs()`: Label `x` axis, `y` axis, legend for `color` of plot, title\\` of plot, etc.\n    -   Wrangling:\n        -   `mutate()`: Mutate the data frame by creating a new column or overwriting one of the existing columns\n        -   `count()`: Count the number of observations for each level of a categorical variable (factor) or each distinct value of any other type of variable\n        -   `group_by()`: Perform each subsequent action once per each group of the variable, where groups can be defined based on the levels of one or more variables\n        -   `summarize()`: Calculate summary statistics\n-   Introduced new data wrangling functions:\n    -   `rename()`: Rename columns in a data frame\n    -   `as_factor()`: Convert a variable to a factor\n    -   `drop_na()`: Drop rows that have `NA` in one ore more specified variables\n    -   `if_else()`: Write logic for what happens if a condition is true and what happens if it's not\n    -   `case_when()`: Write a generalized `if_else()` logic for more than one condition\n    -   `fct_relevel`: Change the order of levels in a factor\n-   Introduced new data visualization functions:\n    -   `geom_col()`: Represent data with bars (**col**umns), for heights that have already been calculated (must define `x` **and** `y` aesthetics)\n    -   `scale_fill_viridis_d()`: Customize the **d**iscrete `fill` scale, using a color-blind friendly, ordinal **d**iscrete color scale\n    -   `scale_y_discrete()`: Customize the discrete `y` scale\n    -   `scale_fill_manual()`: Customize the `fill` scale by manually adjusting values for colors\n\n## Quarto\n\nWe also introduced chunk options for managing figure sizes:\n\n-   `fig-width`: Width of figure\n-   `fig-asp`: Aspect ratio of figure (height / width)\n-   `fig-height`: Height of figure -- but I recommend using `fig-width` and `fig-asp`, instead of `fig-width` and `fig-height`\n\n# Acknowledgements\n\nThis dataset was cleaned and prepared for analysis by Duke StatSci PhD student [Sam Rosen](https://samgrosen.github.io/).\n",
    "supporting": [
      "ae-05-durham-sa_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}